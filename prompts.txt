# PracticaAPI - Sistema de GestiÃ³n de Presupuestos
# Archivo de Prompts y Comandos Ãštiles

## ğŸ“‹ DESCRIPCIÃ“N DEL PROYECTO
API REST para gestiÃ³n de presupuestos mensuales con categorÃ­as y gastos.
- .NET 8.0
- Entity Framework Core
- SQL Server (Somee.com)
- Swagger/OpenAPI

## ğŸ—ï¸ ESTRUCTURA DEL PROYECTO
```
PracticaAPI/
â”œâ”€â”€ Controllers/          # Controladores de la API
â”‚   â”œâ”€â”€ BudgetsController.cs
â”‚   â”œâ”€â”€ CategoriesController.cs
â”‚   â””â”€â”€ ExpensesController.cs
â”œâ”€â”€ Core/                 # LÃ³gica de negocio
â”‚   â””â”€â”€ Entities/
â”‚       â”œâ”€â”€ MonthlyBudget.cs
â”‚       â”œâ”€â”€ BudgetCategory.cs
â”‚       â”œâ”€â”€ Expense.cs
â”‚       â””â”€â”€ Services/
â”‚           â”œâ”€â”€ BudgetService.cs
â”‚           â””â”€â”€ Interfaces/
â”‚               â””â”€â”€ IBudgetService.cs
â”œâ”€â”€ Data/                 # Capa de datos
â”‚   â””â”€â”€ AppDbContext.cs
â”œâ”€â”€ DTOs/                 # Objetos de transferencia
â”‚   â”œâ”€â”€ BudgetDto.cs
â”‚   â”œâ”€â”€ BudgetDetailDto.cs
â”‚   â”œâ”€â”€ BudgetCategoryDto.cs
â”‚   â”œâ”€â”€ CreateBudgetDto.cs
â”‚   â”œâ”€â”€ CreateCategoryDto.cs
â”‚   â”œâ”€â”€ CreateExpenseDto.cs
â”‚   â”œâ”€â”€ ExpenseDto.cs
â”‚   â”œâ”€â”€ UpdateCategoryDto.cs
â”‚   â””â”€â”€ UpdateExpenseDto.cs
â””â”€â”€ Properties/
    â””â”€â”€ launchSettings.json
```

## ğŸš€ COMANDOS IMPORTANTES

### CompilaciÃ³n y EjecuciÃ³n
```bash
# Restaurar paquetes
dotnet restore

# Compilar proyecto
dotnet build

# Ejecutar en desarrollo
dotnet run

# Ejecutar en producciÃ³n
dotnet run --environment Production
```

### Entity Framework
```bash
# Instalar herramientas EF (si no estÃ¡n instaladas)
dotnet tool install --global dotnet-ef

# Crear migraciÃ³n inicial
dotnet ef migrations add InitialCreate

# Aplicar migraciones a la base de datos
dotnet ef database update

# Ver migraciones pendientes
dotnet ef migrations list

# Revertir Ãºltima migraciÃ³n
dotnet ef database update PreviousMigrationName
```

### Git
```bash
# Ver estado
git status

# Agregar cambios
git add .

# Hacer commit
git commit -m "DescripciÃ³n del cambio"

# Subir a GitHub
git push

# Ver historial
git log --oneline
```

## ğŸ“¡ ENDPOINTS DE LA API

### Presupuestos (/api/budgets)
- GET /api/budgets - Obtener todos los presupuestos
- GET /api/budgets/{id} - Obtener presupuesto por ID
- POST /api/budgets - Crear nuevo presupuesto
- POST /api/budgets/{budgetId}/expenses - Agregar gasto a presupuesto
- DELETE /api/budgets/{id} - Eliminar presupuesto

### CategorÃ­as (/api/categories)
- GET /api/categories - Obtener todas las categorÃ­as
- GET /api/categories/{id} - Obtener categorÃ­a por ID
- GET /api/categories/budget/{budgetId} - Obtener categorÃ­as por presupuesto
- POST /api/categories - Crear nueva categorÃ­a
- PUT /api/categories/{id} - Actualizar categorÃ­a
- DELETE /api/categories/{id} - Eliminar categorÃ­a

### Gastos (/api/expenses)
- GET /api/expenses - Obtener todos los gastos
- GET /api/expenses/{id} - Obtener gasto por ID
- GET /api/expenses/category/{categoryId} - Obtener gastos por categorÃ­a
- POST /api/expenses - Crear nuevo gasto
- PUT /api/expenses/{id} - Actualizar gasto
- DELETE /api/expenses/{id} - Eliminar gasto

## ğŸ”§ CONFIGURACIÃ“N

### Seguridad
- **AutenticaciÃ³n**: JWT Bearer Token
- **AutorizaciÃ³n**: Requerida para todos los endpoints CRUD
- **CORS**: Configurado para permitir peticiones cross-origin
- **Filtro de IP**: Solo permite acceso desde 187.155.101.200

### Base de Datos
- **Tipo**: InMemory Database (para desarrollo)
- **Nombre**: PracticaAPIDb

### Swagger UI
- **URL**: https://localhost:7000/swagger
- **URL alternativa**: http://localhost:5000/swagger

### Endpoints de Prueba
- **GET** `/api/test/status` - Estado de la API con informaciÃ³n de IP
- **GET** `/api/test/ip` - Verificar IP del cliente
- **GET** `/api/test/ip-test` - Probar filtro de IP especÃ­ficamente
- **GET** `/api/test/auth-test` - Probar autenticaciÃ³n (requiere token)

### ğŸ” AutenticaciÃ³n JWT

#### 1. Registro de usuario:
```bash
POST /api/auth/register
Content-Type: application/json

{
  "username": "tu_usuario",
  "password": "tu_contraseÃ±a",
  "confirmPassword": "tu_contraseÃ±a"
}
```

#### 2. Login para obtener token:
```bash
POST /api/auth/login
Content-Type: application/json

{
  "username": "tu_usuario",
  "password": "tu_contraseÃ±a"
}
```

#### 3. Usar el token en las peticiones:
```bash
GET /api/budgets
Authorization: Bearer tu_token_aqui
```

### âš ï¸ Notas importantes:
- **Todos los endpoints CRUD requieren autenticaciÃ³n** (excepto `/api/auth/*` y `/api/test/*`)
- **Solo la IP `187.155.101.200` puede acceder** a la API
- **El token expira en 7 dÃ­as**
- **Error 401**: Token invÃ¡lido o faltante
- **Error 403**: IP no autorizada

## ğŸ“ EJEMPLOS DE USO

### Crear un presupuesto
```json
POST /api/budgets
{
  "month": "2024-01-01T00:00:00Z",
  "categories": [
    {
      "name": "Comida",
      "limit": 500.00
    },
    {
      "name": "Transporte",
      "limit": 200.00
    }
  ]
}
```

### Crear una categorÃ­a
```json
POST /api/categories
{
  "name": "Entretenimiento",
  "limit": 150.00,
  "monthlyBudgetId": "guid-del-presupuesto"
}
```

### Registrar un gasto
```json
POST /api/expenses
{
  "amount": 25.50,
  "categoryId": "guid-de-la-categoria"
}
```

## ğŸ› SOLUCIÃ“N DE PROBLEMAS

### Error de compilaciÃ³n
1. Verificar que todos los paquetes NuGet estÃ©n instalados
2. Ejecutar `dotnet restore --force`
3. Limpiar y reconstruir: `dotnet clean && dotnet build`

### Error de conexiÃ³n a base de datos
1. Verificar la cadena de conexiÃ³n en appsettings.json
2. Asegurar que las migraciones estÃ©n aplicadas
3. Verificar conectividad a internet

### Error de Entity Framework
1. Verificar que las herramientas EF estÃ©n instaladas
2. Ejecutar `dotnet ef database update`
3. Verificar que el DbContext estÃ© configurado correctamente

## ğŸ“š RECURSOS ÃšTILES
- [DocumentaciÃ³n .NET 8](https://docs.microsoft.com/en-us/dotnet/)
- [Entity Framework Core](https://docs.microsoft.com/en-us/ef/core/)
- [ASP.NET Core Web API](https://docs.microsoft.com/en-us/aspnet/core/web-api/)
- [Swagger/OpenAPI](https://swagger.io/docs/)

## ğŸ”„ FLUJO DE DESARROLLO
1. Hacer cambios en el cÃ³digo
2. Compilar con `dotnet build`
3. Probar endpoints con Swagger
4. Crear migraciones si hay cambios en el modelo
5. Aplicar migraciones a la base de datos
6. Hacer commit y push a GitHub 